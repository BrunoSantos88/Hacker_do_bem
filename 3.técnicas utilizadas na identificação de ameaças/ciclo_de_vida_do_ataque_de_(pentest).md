# A fase do ciclo de vida do ataque de pen test 

- È fundamental para a realização de testes de penetração de forma organizada e eficaz. Vamos considerar aqui os testes de penetração usando um ciclo de vida de kill chain estruturado, que envolve várias etapas. A kill chain é um termo comumente utilizado em segurança cibernética e defesa cibernética para descrever as etapas sequenciais que um atacante segue durante um ataque cibernético, desde o planejamento inicial até a execução e exploração bem-sucedida de um sistema ou rede. Essas etapas são projetadas para representar o ciclo de vida típico de um ataque e podem ser usadas para entender, analisar e defender-se contra ameaças cibernéticas. A ideia por trás da kill chain é que, se uma organização for capaz de identificar e interromper uma etapa da cadeia, poderá impedir um ataque cibernético antes que ele tenha sucesso. As etapas da kill chain geralmente incluem:

- Reconhecimento: nesta fase, o testador de penetração reúne informações sobre o alvo, como redes, sistemas e aplicativos a serem testados, identificação de vulnerabilidades, sistemas em uso, funcionários, parceiros e outros detalhes relevantes. Isso pode incluir varredura de DNS, pesquisa de informações publicamente disponíveis (OSINT) e outras técnicas.

- Exploração: o testador busca vulnerabilidades nos sistemas e aplicativos identificados durante a fase de reconhecimento. Isso pode envolver a exploração de falhas de segurança conhecidas ou a busca por fraquezas específicas. Nesse momento, uma ferramenta de software é usada para obter algum tipo de acesso à rede do alvo. Isso pode ser feito usando um e-mail e payload de phishing ou obtendo credenciais por meio de engenharia social. Tendo conquistado a posição, o pen tester pode então começar a proteger e ampliar o acesso.

- Persistência: após a exploração bem-sucedida, o testador estabelece uma presença persistente no sistema, geralmente por meio da instalação de backdoors ou outras ferramentas. Trata-se da capacidade do testador de se reconectar ao host comprometido e usá-lo como uma ferramenta de acesso remoto (RAT) ou backdoor. Para fazer isso, o testador deve estabelecer uma rede de comando e controle (C2 ou C&C) usando para controlar o host comprometido, carregar ferramentas de ataque adicionais e baixar dados exfiltrados. A conexão com o host comprometido normalmente exigirá que um executável de malware seja executado após eventos de desligamento/logoff e que uma conexão com uma porta de rede e o endereço IP do invasor estejam disponíveis.

- Escalonamento de privilégios: a persistência é seguida por um reconhecimento adicional, onde o pen tester tenta mapear a rede interna e descobrir os serviços em execução nela e as contas configuradas para acessá-la. Mover-se dentro da rede ou acessar ativos de dados provavelmente exigirá níveis de privilégio mais elevados. Por exemplo, o malware original pode ter sido executado com privilégios de administrador local em uma estação de trabalho cliente ou como usuário Apache em um servidor web. Outra exploração pode permitir que o malware seja executado com privilégios de sistema/root ou use privilégios de administrador de rede em outros hosts, como servidores de aplicativos. Se o objetivo for obter acesso privilegiado, o testador busca maneiras de aumentar suas permissões e níveis de acesso.

- Movimento lateral/pivotagem: Ganhando controle sobre outros hosts. O testador explora a rede, procurando outros sistemas para se movimentar lateralmente dentro da organização. Isso é feito em parte para descobrir mais oportunidades de ampliar o acesso (coleta de credenciais, detecção de vulnerabilidades de software e outros), em parte para identificar onde ativos de dados valiosos podem estar localizados e em parte para evitar a detecção. O movimento lateral geralmente envolve a execução de ferramentas de ataque em compartilhamentos de processos remotos ou o uso de ferramentas de script, como o PowerShell. Se o pen tester conseguir uma posição segura em um servidor de perímetro, um pivô permitirá que ele contorne um limite de rede e comprometa servidores em uma rede interna. Um pivô normalmente é realizado usando protocolos de acesso remoto e tunelamento, como Secure Shell (SSH), rede privada virtual (VPN) ou área de trabalho remota.

- Ações baseadas em objetivos: esta é a fase em que o testador executa ações maliciosas planejadas, como roubo de dados, danos ao sistema, interrupção de operações ou outros objetivos específicos. Para um agente de ameaça, isso significa roubar dados de um ou mais sistemas (exfiltração de dados). Da perspectiva de um pen tester, seria uma questão de definição do escopo se isso seria tentado. Na maioria dos casos, é geralmente suficiente mostrar que as ações relativas aos objetivos podem ser alcançadas.

- Fases de limpeza: após concluir o teste de penetração, o testador remove todos os vestígios de sua presença no sistema, garantindo que não deixe rastros indesejados. Para um autor da ameaça, isso significa remover evidências do ataque, ou pelo menos evidências que possam implicar o autor da ameaça. Para um pen tester, essa fase significa remover quaisquer backdoors ou ferramentas e garantir que o sistema não seja menos seguro do que o estado de pré-engajamento.